name: Optimize Blog Images

on:
  push:
    paths:
      - "src/content/blog/**"
      - "src/content/blog/**/*.png"

  # ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì˜µì…˜
  workflow_dispatch:

jobs:
  convert-images:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libvips-dev

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: |
          npm install
          git status
          git diff package-lock.json

      - name: Convert PNG to WebP
        run: npm run convert-images

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: |
            ğŸ¨ optimize: Convert PNG images to WebP format

            - Update package-lock.json with new dependencies
          title: "ğŸ¨ optimize: Convert PNG images to WebP format"
          body: |
            ì´ë¯¸ì§€ ìµœì í™” ìë™í™” PRì…ë‹ˆë‹¤:
            - PNG ì´ë¯¸ì§€ë¥¼ WebP í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            - ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ë‚´ ì´ë¯¸ì§€ ì°¸ì¡° ì—…ë°ì´íŠ¸
            - package-lock.json ì—…ë°ì´íŠ¸

            ìë™ ìƒì„±ëœ PRì…ë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì„ ê²€í† í•´ ì£¼ì„¸ìš”.
          branch: optimize-images
          delete-branch: true
          labels: |
            optimization
            automated pr
