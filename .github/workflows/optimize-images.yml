name: Optimize Blog Images

on:
  push:
    paths:
      - "src/content/blog/**/*.png"

  # 수동으로 워크플로우를 실행할 수 있는 옵션
  workflow_dispatch:

jobs:
  convert-images:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libvips-dev

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Convert PNG to WebP
        run: npm run convert-images

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "🎨 optimize: Convert PNG images to WebP format"
          title: "🎨 optimize: Convert PNG images to WebP format"
          body: |
            이미지 최적화 자동화 PR입니다:
            - PNG 이미지를 WebP 형식으로 변환
            - 마크다운 파일 내 이미지 참조 업데이트

            자동 생성된 PR입니다. 변경 사항을 검토해 주세요.
          branch: optimize-images
          delete-branch: true
          labels: |
            optimization
            automated pr
